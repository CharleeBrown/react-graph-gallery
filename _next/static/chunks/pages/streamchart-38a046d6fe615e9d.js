(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5503],{7591:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/streamchart",function(){return i(5181)}])},6820:function(e,t,i){"use strict";i.d(t,{Z:function(){return o}});var s=i(5893);i(7294);var n=i(8843),r=i(6438);let a=e=>{let{imgLink:t,height:i,opacity:n,children:r}=e;return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{style:{backgroundImage:"url("+t+")",height:i,backgroundAttachment:"fixed",opacity:n,backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}}),(0,s.jsx)("div",{className:"absolute top-0 left-0 w-full h-full",children:r})]})};function o(e){var t;let{chartId:i}=e,o=(null===(t=n.c.find(e=>e.id===i))||void 0===t?void 0:t.label)||"chart";return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{id:"inspiration",children:o+" inspiration"}),(0,s.jsxs)("p",{children:["If you're looking for inspiration to create your next"," ",(0,s.jsx)("span",{children:o}),", note that"," ",(0,s.jsx)("a",{href:"https://www.dataviz-inspiration.com",children:"dataviz-inspiration.com"})," ","showcases many examples. Definitely the best place to get ... inspiration!"]}),(0,s.jsx)("div",{className:"border mb-10",children:(0,s.jsx)(a,{height:250,imgLink:"https://github.com/holtzy/dataviz-inspiration/blob/main/public/misc/overview1.png?raw=true",opacity:.3,children:(0,s.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,s.jsxs)("div",{style:{maxWidth:400},className:"flex flex-col items-center",children:[(0,s.jsxs)("p",{className:"text-center text-sm",children:[(0,s.jsx)("a",{href:"https://www.dataviz-inspiration.com",children:"dataviz-inspiration.com"})," ","showcases hundreds of stunning dataviz projects. Have a look to get some ideas on how to make your ",(0,s.jsx)("span",{children:o})," ","looks good!"]}),(0,s.jsx)(r.J,{href:"https://www.dataviz-inspiration.com",isFilled:!0,size:"md",children:"visit"})]})})})})]})}},505:function(e,t,i){"use strict";i.d(t,{r:function(){return l}});var s=i(5893),n=i(1664),r=i.n(n),a=i(8843),o=i(88),h=i(3572);let l=e=>{let{chartId:t}=e,i=a.c.filter(e=>e.id===t)[0].label;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{id:"responsiveness",children:"Responsive "+i+" with react"}),(0,s.jsxs)("p",{children:["The component above is not responsive. It expects 2 props called"," ",(0,s.jsx)("code",{children:"width"})," and ",(0,s.jsx)("code",{children:"height"})," and will render a ",i," of those dimensions."]}),(0,s.jsxs)("p",{children:["Making the ",i," responsive requires adding a ",(0,s.jsx)("b",{children:"wrapper"})," component that gets the dimension of the parent ",(0,s.jsx)("code",{children:"div"}),", and listening to a potential dimension change. This is possible thanks to a hook called"," ",(0,s.jsx)("code",{children:"useDimensions"})," that will do the job for us."]}),(0,s.jsx)(o.U,{startOpen:!1,title:(0,s.jsxs)("span",{children:[(0,s.jsx)("code",{children:"useDimensions"}),": a hook to make your viz responsive"]}),children:(0,s.jsx)(h.d,{code:c})}),(0,s.jsxs)("p",{children:["I'm in the process of writing a complete blog post on the topic."," ",(0,s.jsx)(r(),{href:"/subscribe",children:"Subscribe to the project"})," to know when it's ready."]}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{})]})},c='\nexport const useDimensions = (targetRef: React.RefObject<HTMLDivElement>) => {\n\n  const getDimensions = () => {\n    return {\n      width: targetRef.current ? targetRef.current.offsetWidth : 0,\n      height: targetRef.current ? targetRef.current.offsetHeight : 0\n    };\n  };\n\n  const [dimensions, setDimensions] = useState(getDimensions);\n\n  const handleResize = () => {\n    setDimensions(getDimensions());\n  };\n\n  useEffect(() => {\n    window.addEventListener("resize", handleResize);\n    return () => window.removeEventListener("resize", handleResize);\n  }, []);\n\n  useLayoutEffect(() => {\n    handleResize();\n  }, []);\n\n  return dimensions;\n}\n'.trim()},5181:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return R}});var s=i(5893),n=i(7294),r=i(153),a=i(9965),o=i(7262),h=i(3572),l=i(1122),c=i(1664),d=i.n(c),p=i(6820);let u=[{x:1,groupA:38,groupB:19,groupC:9,groupD:4},{x:2,groupA:16,groupB:14,groupC:96,groupD:40},{x:3,groupA:64,groupB:96,groupC:64,groupD:40},{x:4,groupA:32,groupB:48,groupC:64,groupD:40},{x:5,groupA:12,groupB:18,groupC:14,groupD:10}];var x=i(6020);let g={top:30,right:30,bottom:50,left:50},m=e=>{let{width:t,height:i,data:r}=e,a=t-g.right-g.left,o=i-g.top-g.bottom,h=["groupA","groupB","groupC","groupD"],l=x.knu().keys(h).order(x.Qxt).offset(x.KuJ),c=l(r),d=(0,n.useMemo)(()=>x.BYU().domain([-200,200]).range([o,0]),[r,i]),[p,u]=x.Wem(r,e=>e.x),m=(0,n.useMemo)(()=>x.BYU().domain([p||0,u||0]).range([0,a]),[r,t]),f=x.PKp().domain(h).range(["#e0ac2b","#e85252","#6689c6","#9a6fb0","#a53253"]),j=x.SOn().x(e=>m(e.data.x)).y1(e=>d(e[1])).y0(e=>d(e[0])).curve(x.zgE),v=c.map((e,t)=>{let i=j(e);return(0,s.jsx)("path",{d:i,opacity:1,stroke:"grey",fill:f(e.key),fillOpacity:.8},t)}),w=m.ticks(5).map((e,t)=>(0,s.jsxs)("g",{children:[(0,s.jsx)("line",{x1:m(e),x2:m(e),y1:0,y2:o,stroke:"#808080",opacity:.2}),(0,s.jsx)("text",{x:m(e),y:o+10,textAnchor:"middle",alignmentBaseline:"central",fontSize:9,stroke:"#808080",opacity:.8,children:e})]},t));return(0,s.jsx)("div",{children:(0,s.jsx)("svg",{width:t,height:i,children:(0,s.jsxs)("g",{width:a,height:o,transform:"translate(".concat([g.left,g.top].join(","),")"),children:[w,v]})})})},f=e=>{let{width:t=700,height:i=400}=e;return(0,s.jsx)(m,{data:u,width:t,height:i})};var j=i(505);let v=e=>{let t=[];return e.forEach(e=>{let i=t.find(t=>t.date===e.date);if(i)i[e.group]=e.value;else{let i={date:e.date};i[e.group]=e.value,t.push(i)}}),t},w=x.i$Z("%B %Y"),y=e=>{let{xScale:t,height:i}=e,n=t.ticks(5).map((e,n)=>(0,s.jsxs)("g",{children:[(0,s.jsx)("line",{x1:t(e),x2:t(e),y1:0,y2:i,stroke:"#808080",opacity:.2}),(0,s.jsx)("text",{x:t(e),y:i+10,textAnchor:"middle",alignmentBaseline:"central",fontSize:9,stroke:"#808080",fill:"none",opacity:.8,children:w(e)})]},n));return(0,s.jsx)(s.Fragment,{children:n})};var b=i(2236);let k=e=>{let{labelInfos:t,xStart:i,xEnd:n,biggestValue:r}=e,a=x.BYU().domain([0,r]).range([i+30,n-20]),o=t.map((e,t)=>{let n=Math.floor(e.value/1e6);return(0,s.jsxs)("g",{children:[(0,s.jsx)("line",{x1:i+2,x2:i+30-2,y1:e.position,y2:e.position,stroke:"#808080",opacity:.9,"stroke-dasharray":2}),(0,s.jsx)(z,{color:e.color,x:a(0),y:e.position-10,width:a(e.value)-a(0)}),(0,s.jsx)("text",{x:i+30+2,y:e.position,textAnchor:"start",alignmentBaseline:"central",fontSize:12,stroke:"#808080",fill:"none",children:e.name+" | "+n+"M"})]},t)});return(0,s.jsx)(s.Fragment,{children:o})},z=e=>{let{color:t,x:i,y:n,width:r}=e,a=(0,b.q_)({to:{width:r},config:{friction:10,bounce:0}});return(0,s.jsx)(b.q.rect,{x:i,y:n,width:a.width,height:20,opacity:.7,stroke:t,fill:t,fillOpacity:.3,strokeWidth:1,rx:1})},S=e=>{let{x:t,height:i}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("line",{x1:t,x2:t,y1:0,y2:i,stroke:"black",strokeWidth:1})})},T={top:10,right:250,bottom:90,left:0},B=x.Z1g("%Y-%m-%d"),D=e=>{let{width:t,height:i,data:r,startDate:a}=e,[o,h]=(0,n.useState)(null),l=t-T.right-T.left,c=i-T.top-T.bottom,d=r.filter(e=>B(e.date)>a),p=x.Fp7(d.map(e=>e.value)),u=[...new Set(r.map(e=>e.group))],g=v(d),m=x.knu().keys(u).order(x.Qxt).offset(x.KuJ),f=m(g),j=f.flatMap(e=>e.map(e=>e[1])),w=x.BYU().domain([Math.min(...j),Math.max(...j)]).range([c,0]),b=x.Wem(d.map(e=>B(e.date))),z=x.Xf().domain(b).range([0,l]),D=x.PKp().domain(u).range(["#e0ac2b","#e85252","#6689c6","#9a6fb0","#a53253"]),A=x.SOn().x(e=>z(B(e.data.date))).y1(e=>w(e[1])).y0(e=>w(e[0])).curve(x.zgE),N=f.map((e,t)=>{let i=A(e);return(0,s.jsx)("path",{d:i,opacity:1,stroke:"grey",fill:D(e.key),fillOpacity:.8},t)}),E=f.map(e=>{let t=e[e.length-1],i=o?o[e.key]:t[1]-t[0];return{name:e.key,color:D(e.key),value:i,position:w((t[0]+t[1])/2)}}),M=e=>{let t=z.invert(e),i=1/0,s=null;for(let e of g){var n;let r=null===(n=B(e.date))||void 0===n?void 0:n.getTime();if(!r)return null;let a=Math.abs(r-t.getTime());a<i&&(i=a,s=e)}return s},R=e=>{let t=e.currentTarget.getBoundingClientRect(),i=e.clientX-t.left,s=M(i);h(s)};return(0,s.jsx)("div",{children:(0,s.jsx)("svg",{width:t,height:i,children:(0,s.jsxs)("g",{width:l,height:c,transform:"translate(".concat([T.left,T.top].join(","),")"),children:[(0,s.jsx)(y,{xScale:z,height:c}),(0,s.jsx)(k,{labelInfos:E,xStart:z.range()[1],xEnd:t,biggestValue:p}),N,o&&(0,s.jsx)(S,{height:c,x:z(B(o.date)),biggestValue:p}),(0,s.jsx)("rect",{x:0,y:0,width:l,height:c,onMouseMove:R,onMouseLeave:()=>h(null),visibility:"hidden",pointerEvents:"all",cursor:"pointer"})]})})})},A=x.i$Z("%B %Y"),N=e=>{var t,i;let{width:r,height:a}=e,[o,h]=(0,n.useState)(),[l,c]=(0,n.useState)(B("2015-01-01"));return((0,n.useEffect)(()=>{let e=async()=>{let e=await fetch("https://raw.githubusercontent.com/holtzy/react-graph-gallery/main/data/data_page_views.csv"),t=await e.text(),i=(0,x.ueB)(t);h(i)};e()},[]),o&&l)?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{height:150},children:[(0,s.jsx)("p",{style:{fontSize:17,paddingTop:40,marginBottom:0},children:(0,s.jsx)("b",{children:"Chat-GPT hasn't impacted tech websites traffic significantly (yet)"})}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,s.jsxs)("p",{style:{fontSize:12,width:155,paddingTop:11},children:["Data since ",(0,s.jsx)("b",{children:A(l)})]}),(0,s.jsx)("input",{type:"range",min:null===(t=B("2015-01-01"))||void 0===t?void 0:t.getTime(),max:null===(i=B("2022-09-01"))||void 0===i?void 0:i.getTime(),value:l.getTime(),step:1e4,onChange:e=>c(new Date(Number(e.target.value))),style:{height:1,opacity:.5,width:80}})]})]}),(0,s.jsx)(D,{width:r,height:a-150,data:o,startDate:l})]}):null},E=e=>{let{width:t=700,height:i=400}=e;return(0,s.jsx)(N,{width:t,height:i})},M=(0,s.jsxs)("p",{children:["A"," ",(0,s.jsx)("a",{href:"https://www.data-to-viz.com/graph/streamgraph.html",children:"streamgraph"})," ","is a variation of the more common"," ",(0,s.jsx)(d(),{href:"stacked-area-plot",children:"stacked area chart"}),". This section explains how to stack and smooth the data with ",(0,s.jsx)("code",{children:"d3.js"}),", and render the shapes with ",(0,s.jsx)("code",{children:"react"}),". It starts from the basic and goes until necessary customization like tooltips, hover effect, legend and annotation, always with editable sandboxes."]});function R(){return(0,s.jsxs)(r.A,{title:"Streamchart with React",seoDescription:"How to build a stream chart with React and D3.js. A set of re-usable components",children:[(0,s.jsx)(a.Z,{title:"Streamcharts",description:M,chartType:"stream"}),(0,s.jsx)("h2",{id:"data",children:"The Data"})," ",(0,s.jsx)("p",{children:"Most of the time the input dataset is an array where each item is an object."}),(0,s.jsxs)("p",{children:["Each object provides information for a step on the X axis. It has a value like ",(0,s.jsx)("code",{children:"x"})," that provides the exact position on the X axis. It then has several numeric values, one for each group of the dataset."]}),(0,s.jsx)("p",{children:"Here is a minimal example:"}),(0,s.jsx)(h.d,{code:_}),(0,s.jsxs)("p",{children:["Note: if your data is in ",(0,s.jsx)("code",{children:".csv"})," format, you can translate it thanks to the ",(0,s.jsx)("code",{children:"d3.csv()"})," function as suggested"," ",(0,s.jsx)("a",{href:"https://d3-graph-gallery.com/graph/line_basic.html",children:"here"}),"."]}),(0,s.jsx)("h2",{id:"Stacking",children:"Stacking series"}),(0,s.jsxs)("p",{children:["Building a stream chart requires to ",(0,s.jsx)("b",{children:"stack"})," the data. Series are displayed one on top of each other and you have to compute their positions on the Y axis."]}),(0,s.jsxs)("p",{children:["Fortunately, ",(0,s.jsx)("code",{children:"D3.js"})," has a handy ",(0,s.jsx)("code",{children:"stack()"})," ","function that does exactly that. The process is deeply explained in the"," ",(0,s.jsx)(d(),{href:"stacked-area-plot",children:"stacked area chart"})," section of the gallery."]}),(0,s.jsxs)("p",{children:["The only variation required here is to use the",(0,s.jsx)("code",{children:"d3.stackOffsetSilhouette"})," offset option. Instead of stacking everything above the 0 baseline, it will put groups on both part of it."]}),(0,s.jsx)("p",{children:"Computing the position of the chart series should look something like:"}),(0,s.jsx)(h.d,{code:I}),(0,s.jsx)("h2",{id:"basic example",children:"Basic streamgraph example"})," ",(0,s.jsxs)("p",{children:["Once more, the process to render the shape is very close to the"," ",(0,s.jsx)(d(),{href:"stacked-area-plot",children:"stacked area chart"}),". A few variations are required though."]}),(0,s.jsx)("h3",{children:"→ Smoothing"}),(0,s.jsxs)("p",{children:["We need to smooth the area shape to get the good-looking organic flow. Once more d3 is here to the rescue with a"," ",(0,s.jsx)("a",{href:"https://github.com/d3/d3-shape#curves",children:"curve"})," function that does all the work for us."]}),(0,s.jsx)("h3",{children:"→ Axis"}),(0,s.jsxs)("p",{children:[(0,s.jsx)(d(),{href:"build-axis-with-react",children:"Usual axes"})," do not work for streamgraphs. The Y axis would make no sense since shapes are on both side of the 0 baseline. It is commonly"," ",(0,s.jsx)("a",{href:"https://www.dataviz-inspiration.com/stream",children:"removed"}),". The X axis would feel lost alone at the very bottom of the chart."]}),(0,s.jsx)("p",{children:"Here I suggest to replace the X axis with vertical ablines. The Y axis is removed and we will see later how"}),(0,s.jsx)(l.$,{vizName:"StreamGraphBasic",VizComponent:f,height:400,maxWidth:600,caption:"Most basic streamgraph with react and d3.js"}),(0,s.jsx)(j.r,{chartId:"stream"}),(0,s.jsx)(p.Z,{chartId:"stream"}),(0,s.jsx)("h2",{id:"application",children:"Application"})," ",(0,s.jsxs)("p",{children:["The following chart is a real-life application of a ",(0,s.jsx)("b",{children:"streamgraph"}),". It shows the evolution if the ",(0,s.jsx)("b",{children:"number of page-views"})," for 5 tech websites in the last 7 years. My goal was to assess if the rise of"," ",(0,s.jsx)("a",{href:"https://openai.com/blog/chatgpt",children:"chat-GPT"})," had an impact on it."]}),(0,s.jsxs)("p",{children:["This ",(0,s.jsx)("b",{children:"interactive"})," chart has several interesting features:"]}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("b",{children:"slider"}),": you can control the displayed time-frame thanks to a slider."]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("b",{children:"inline legend"}),": label of each series are written inline. A background proportional to their value provides additional insight."]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("b",{children:"hover effect"}),": legend will be updated with precise values at the hovered timestamp."]})]}),(0,s.jsx)(l.$,{vizName:"StreamGraphPageViews",VizComponent:E,height:600,maxWidth:900,caption:"Most basic streamgraph with react and d3.js"}),(0,s.jsx)("div",{className:"full-bleed border-t h-0 bg-gray-100 my-3"}),(0,s.jsx)(o.Z,{chartFamily:"evolution"}),(0,s.jsx)("div",{className:"mt-20"})]})}let _="\nconst data = [\n  {\n    x: 1,\n    groupA: 38,\n    groupB: 19,\n  },\n  {\n    x: 2,\n    groupA: 16,\n    groupB: 14,\n  },\n  ...\n];\n".trim(),I="\nconst stackSeries = d3\n  .stack()\n  .keys(groups)\n  .order(d3.stackOrderNone)\n  .offset(d3.stackOffsetSilhouette);\nconst series = stackSeries(data);\n".trim()}},function(e){e.O(0,[3996,6020,5660,2236,645,1188,9774,2888,179],function(){return e(e.s=7591)}),_N_E=e.O()}]);