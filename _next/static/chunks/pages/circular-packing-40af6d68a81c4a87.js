(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{3836:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/circular-packing",function(){return t(4058)}])},3485:function(e,n,t){"use strict";t.d(n,{U:function(){return r}});var a=t(5893),i=t(7294),r=function(e){var n=e.startOpen,t=e.title,r=e.children,c=e.toc,s=(0,i.useState)(n),l=s[0],o=s[1],d=l?"max-h-full":"max-h-0",u=l?"overflow-visible":"overflow-hidden";return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("h2",{className:"cursor-pointer",onClick:function(){return o(!l)},id:c,children:[l?(0,a.jsx)("span",{className:"text-purple-700 w-4 mr-2 hover:text-purple-900 inline-block",children:"-"}):(0,a.jsx)("span",{className:"text-purple-700 w-4 mr-2 hover:text-purple-900 inline-block",children:"+"}),t]}),(0,a.jsx)("div",{className:"transition-max-height ease-in duration-300  "+d+" "+u,children:r})]})}},8193:function(e,n,t){"use strict";t.d(n,{d:function(){return s}});var a=t(5893),i=t(4725),r=t.n(i),c=t(7294),s=function(e){var n=e.code,t=(0,c.useRef)(null);return(0,c.useEffect)((function(){t.current&&r().highlightElement(t.current)}),[t,n]),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("pre",{className:"rounded-md line-numbers",children:(0,a.jsx)("code",{ref:t,className:"p-0 language-js",children:n})})})}},4058:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return C}});var a=t(5893),i=t(7294),r=t(1884),c=t(8807),s=t(6978),l=t(7197),o=t(3485),d=t(8193),u=t(33),h=t(5250),p=function(e){var n=e.width,t=e.height,r=e.data,c=(0,i.useMemo)((function(){return h.bT9(r).sum((function(e){return e.value})).sort((function(e,n){return n.value-e.value}))}),[r]),s=(0,i.useMemo)((function(){return h.P2p().size([n,t]).padding(4)(c)}),[c,n,t]);return(0,a.jsxs)("svg",{width:n,height:t,style:{display:"inline-block"},children:[s.descendants().slice(1).map((function(e){return(0,a.jsx)("circle",{cx:e.x,cy:e.y,r:e.r,stroke:"#553C9A",strokeWidth:2,fill:"#B794F4",fillOpacity:.2},e.data.name)})),s.descendants().slice(1).map((function(e){return(0,a.jsx)("text",{x:e.x,y:e.y,fontSize:13,fontWeight:.4,textAnchor:"middle",alignmentBaseline:"middle",children:e.data.name},e.data.name)}))]})},m={type:"node",name:"boss",value:2300,children:[{type:"leaf",name:"Mark",value:90},{type:"leaf",name:"Robert",value:12},{type:"leaf",name:"Emily",value:34},{type:"leaf",name:"Marion",value:53},{type:"leaf",name:"Nicolas",value:98},{type:"leaf",name:"Malki",value:22},{type:"leaf",name:"Dj\xe9",value:12},{type:"leaf",name:"M\xe9lanie",value:45},{type:"leaf",name:"Einstein",value:76}]},f=function(e){var n=e.width,t=void 0===n?700:n,i=e.height,r=void 0===i?400:i;return 0===t?null:(0,a.jsx)(p,{width:t,height:r,data:m})},x=t(9920);function y(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function j(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},a=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),a.forEach((function(n){y(e,n,t[n])}))}return e}function v(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var g=function(e){var n=e.width,t=e.height,r=e.data,c=(0,i.useMemo)((function(){return h.bT9(r).sum((function(e){return e.value})).sort((function(e,n){return n.value-e.value}))}),[r]),s=(0,i.useMemo)((function(){return h.P2p().size([n,t]).padding(4)(c)}),[c,n,t]);return(0,a.jsxs)("svg",{width:n,height:t,style:{display:"inline-block"},children:[s.descendants().slice(1).map((function(e){return(0,a.jsx)(b,{cx:e.x,cy:e.y,r:e.r,stroke:"#553C9A",strokeWidth:2,fill:"#B794F4",fillOpacity:.2},e.data.name)})),s.descendants().slice(1).map((function(e){return(0,a.jsx)(w,{x:e.x,y:e.y,fontSize:13,fontWeight:.4,textAnchor:"middle",alignmentBaseline:"middle",children:e.data.name},e.data.name)}))]})},b=function(e){var n=e.cx,t=e.cy,i=e.r,r=v(e,["cx","cy","r"]),c=(0,x.useSpring)({cx:n,cy:t,r:i});return(0,a.jsx)(x.animated.circle,j({},r,{r:c.r,cx:c.cx,cy:c.cy}))},w=function(e){var n=e.x,t=e.y,i=v(e,["x","y"]),r=(0,x.useSpring)({x:n,y:t});return(0,a.jsx)(x.animated.text,j({},i,{x:r.x,y:r.y}))},k={type:"node",name:"boss",value:2300,children:[{type:"leaf",name:"Mark",value:90},{type:"leaf",name:"Robert",value:12},{type:"leaf",name:"Emily",value:34},{type:"leaf",name:"Marion",value:53},{type:"leaf",name:"Nicolas",value:98},{type:"leaf",name:"Malki",value:22},{type:"leaf",name:"Dj\xe9",value:12},{type:"leaf",name:"M\xe9lanie",value:45},{type:"leaf",name:"Einstein",value:76}]},O={type:"node",name:"boss",value:2300,children:[{type:"leaf",name:"Mark",value:20},{type:"leaf",name:"Robert",value:120},{type:"leaf",name:"Emily",value:23},{type:"leaf",name:"Marion",value:78},{type:"leaf",name:"Nicolas",value:65},{type:"leaf",name:"Malki",value:45},{type:"leaf",name:"Dj\xe9",value:78},{type:"leaf",name:"M\xe9lanie",value:23},{type:"leaf",name:"Einstein",value:12}]},N=function(e){var n=e.width,t=void 0===n?700:n,r=e.height,c=void 0===r?400:r,s=(0,i.useState)(k),l=s[0],o=s[1];return 0===t?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{onClick:function(){return o(k)},children:"Data 1"}),(0,a.jsx)("button",{onClick:function(){return o(O)},children:"Data 2"})]}),(0,a.jsx)(g,{width:t,height:c,data:l})]})},P=(0,a.jsxs)("p",{children:["A"," ",(0,a.jsx)("a",{href:"https://www.data-to-viz.com/graph/circularpacking.html",children:"circular packing chart"})," ","displays a hierarchical dataset as a set of nested circles. Nodes are displayed as circles. Size is usually proportional to a numeric variable."]}),E="\nconst data = {\n  type: 'node',\n  name: \"boss\",\n  value: 2300,\n  children: [\n    {type: 'leaf', name:\"Mark\", value: 90},\n    {type: 'leaf', name:\"Robert\", value: 12},\n    {type: 'leaf', name:\"Emily\", value: 34},\n    ...\n}\n".trim(),M="\nconst AnimatedCircle = ({cx,cy,r,...props}) => {\n  const animatedProps = useSpring({\n    cx,\n    cy,\n    r,\n  });\n  return (\n    <animated.circle\n      {...props}\n      r={animatedProps.r}\n      cx={animatedProps.cx}\n      cy={animatedProps.cy}\n    />\n  );\n}\n".trim();function C(){return(0,a.jsxs)(r.A,{title:"Circular Packing chart with React",seoDescription:"How to build a circular packing chart with React and D3.js. A set of re-usable components",children:[(0,a.jsx)(c.Z,{title:"Circular Packing",description:P,chartType:"circularPacking"}),(0,a.jsxs)(o.U,{title:"Dataset",startOpen:!0,children:[(0,a.jsxs)("p",{children:["The dataset describes a hierarchy using a recursive structure. Each item in this structure is called a node, the lowest nodes of the hierarchy being called leaves. The dataset is an object that has at least 3 properties: ",(0,a.jsx)("code",{children:"name"}),", ",(0,a.jsx)("code",{children:"value"})," and"," ",(0,a.jsx)("code",{children:"children"}),". Children is an array of nodes that have this structure too."]}),(0,a.jsx)("br",{}),(0,a.jsx)("p",{children:"Here is a minimal example of the data structure:"}),(0,a.jsx)(d.d,{code:E})]}),(0,a.jsxs)(o.U,{title:"Most basic circular packing with React and D3.js",startOpen:!0,children:[(0,a.jsxs)("p",{children:["The process used to build a circle packing chart with d3.js is described more in depth in the"," ",(0,a.jsx)("a",{href:"https://www.d3-graph-gallery.com/circularpacking",children:"d3 graph gallery"}),"."]}),(0,a.jsx)("h3",{children:"\u2192 Compute circle position and radius"}),(0,a.jsxs)("p",{children:["Basically, the dataset is given to the ",(0,a.jsx)("code",{children:"d3.hierarchy()"})," ","function of d3 that builds a specific kind of object from it. This object can be consumed by the ",(0,a.jsx)("code",{children:"d3.pack()"})," function of d3 that computes the position and radius of each circle."]}),(0,a.jsx)("h3",{children:"\u2192 Render the circles with react"}),(0,a.jsxs)("p",{children:["It is pretty straightforward to ",(0,a.jsx)("code",{children:"map"})," along each node of the ",(0,a.jsx)("code",{children:"d3.pack()"})," output. For each item, we can render a",(0,a.jsx)("code",{children:"circle"})," element following with a ",(0,a.jsx)("code",{children:"text"})," element to get the following chart."]}),(0,a.jsx)("br",{}),(0,a.jsx)(u.$,{vizName:"CircularPackingBasic",VizComponent:f,maxWidth:400,height:400,caption:"most basic circle packing chart built with react and d3.js"})]}),(0,a.jsxs)(o.U,{title:"Animating dataset transition",startOpen:!0,children:[(0,a.jsx)("p",{children:"The following examples explains how to transition between 2 datasets. Each circle smoothly goes to its new position with its new radius."}),(0,a.jsxs)("p",{children:["This is possible thanks to the ",(0,a.jsx)("code",{children:"react-spring"})," library that does the interpolation and animation. When a new dataset is passed to the component, the ",(0,a.jsx)("code",{children:"hierarchy()"})," and ",(0,a.jsx)("code",{children:"pack()"})," ","functions are triggered to compute the new position and radius of each node. But instead of passing this information to an usual"," ",(0,a.jsx)("code",{children:"circle"})," or ",(0,a.jsx)("code",{children:"text"}),"svg element, it is passed to an animated component that looks like this:"]}),(0,a.jsx)(d.d,{code:M}),(0,a.jsxs)("p",{children:["This component uses the ",(0,a.jsx)("code",{children:"useSpring"})," hook of react spring to interpolate the ",(0,a.jsx)("code",{children:"cx"}),", ",(0,a.jsx)("code",{children:"cy"})," and ",(0,a.jsx)("code",{children:"r"})," ","properties. Those values are passed to a special svg element (",(0,a.jsx)("code",{children:"animated.circle"}),") that does the animation."]}),(0,a.jsx)(u.$,{vizName:"CircularPackingDatasetTransition",VizComponent:N,maxWidth:400,height:400,caption:"Animating the transition between 2 similar dataset with react and d3.js (for rendering) and react spring (for animation)."})]}),(0,a.jsx)("div",{className:"full-bleed border-t h-0 bg-gray-100 my-3"}),(0,a.jsx)(l.Z,{chartFamily:"partOfAWhole"}),(0,a.jsx)("div",{className:"mt-20"}),(0,a.jsx)(s.Z,{})]})}}},function(e){e.O(0,[503,5660,9920,358,6546,9774,2888,179],(function(){return n=3836,e(e.s=n);var n}));var n=e.O();_N_E=n}]);